
<!doctype html>
<html lang="pt-br">
<head>
  <meta charset="utf-8">
  <title>Cadastro — Conectar Conta</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    *{box-sizing:border-box}
    body{margin:0;min-height:100vh;display:grid;place-items:center;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
      background:
        radial-gradient(1200px 800px at 85% 10%, #00c2ff 0%, transparent 60%),
        radial-gradient(1000px 800px at 15% 90%, #ff2ea6 0%, transparent 55%),
        linear-gradient(180deg,#0b1024,#130a1f); color:#f8fafc}
    .phone{width:min(420px,92vw);aspect-ratio:9/16;position:relative;border-radius:26px;padding:26px;
      background:linear-gradient(180deg,#ffffff07,#ffffff03);
      box-shadow:0 40px 120px rgba(0,0,0,.6), inset 0 1px 0 rgba(255,255,255,.12);
      border:1px solid rgba(255,255,255,.18); display:flex;align-items:center;justify-content:center}
    .card{width:100%;max-width:360px;padding:22px 20px 18px;background:#ffffff10;border:1px solid #ffffff28;
      backdrop-filter:blur(20px);border-radius:20px;box-shadow:0 0 0 1px rgba(255,255,255,.06), 0 20px 60px rgba(0,0,0,.55); position:relative}
    .card:after{content:"";position:absolute;inset:-1px;border-radius:inherit;pointer-events:none;box-shadow:0 0 0 1px rgba(255,255,255,.08),0 0 30px 2px rgba(0,194,255,.25),0 0 36px 4px rgba(255,46,166,.18)}
    h1{margin:0 0 6px;font-size:20px}
    p.sub{margin:0 0 16px;opacity:.9;font-size:13px}
    .row{display:flex;gap:10px;align-items:center}
    .field{margin:10px 0}
    .field input{width:100%;padding:12px 14px;color:#f8fafc;background:#070a17e0;border:1px solid #263055;border-radius:12px;outline:none}
    .avatar{width:56px;height:56px;border-radius:50%;border:1px solid #3b445d;object-fit:cover;background:#111}
    .cta{display:flex;gap:10px;margin-top:10px}
    .cta button{flex:1;padding:12px 14px;border:0;border-radius:12px;cursor:pointer;font-weight:800}
    .primary{background:linear-gradient(180deg,#00c2ff,#0ea5e9);color:#001020;box-shadow:0 10px 24px rgba(14,165,233,.35)}
    .ghost{background:transparent;color:#e5e7eb;border:1px solid #ffffff28}
    .muted{font-size:12px;opacity:.8}
    .err{color:#fecaca;font-size:13px;margin-top:6px;display:none}
    .ok{color:#bbf7d0;font-size:13px;margin-top:6px;display:none}
  </style>
</head>
<body>
  <div class="phone">
    <div class="card">
      <h1>Finalizar cadastro</h1>
      <p class="sub">Usaremos seu perfil do YouTube para começar.</p>

      <div class="row">
        <img id="avatar" class="avatar" alt="avatar">
        <div>
          <div id="nameLbl" class="muted">Nome</div>
          <div id="emailLbl" class="muted">Email</div>
        </div>
      </div>

      <div class="field"><input id="name" placeholder="Nome completo"></div>
      <div class="field"><input id="email" placeholder="Email" readonly></div>
      <div class="field"><input id="username" placeholder="Nome de Usuário (sem @)"></div>

      <div class="cta">
        <button id="back" class="ghost">Voltar</button>
        <button id="close" class="ghost">Desligar</button>
        <button id="create" class="primary">Criar conta</button>
      </div>

      <div id="err" class="err"></div>
      <div id="ok" class="ok"></div>
    </div>
  </div>

  <script>
    function qs(k){return new URLSearchParams(location.search).get(k)}
    const sid = qs('sid');

    const name = document.getElementById('name');
    const email = document.getElementById('email');
    const username = document.getElementById('username');
    const avatar = document.getElementById('avatar');
    const nameLbl = document.getElementById('nameLbl');
    const emailLbl = document.getElementById('emailLbl');
    const elErr = document.getElementById('err');
    const elOk = document.getElementById('ok');

    function showErr(msg){ elErr.textContent = msg; elErr.style.display = 'block'; elOk.style.display='none'; }
    function showOk(msg){ elOk.textContent = msg; elOk.style.display = 'block'; elErr.style.display='none'; }

    async function load(){
      if (!sid){ showErr('Sessão não encontrada.'); return; }
      try{
        const r = await fetch(`/api/oauth/google/session/${sid}`);
        if (!r.ok){ showErr('Sessão expirada ou inválida.'); return; }
        const j = await r.json();
        const p = j.profile || {};
        name.value = p.name || '';
        email.value = p.email || '';
        username.value = (p.email||'').split('@')[0] || '';
        avatar.src = p.picture || '';
        nameLbl.textContent = p.name || '—';
        emailLbl.textContent = p.email || '—';
      }catch(e){ showErr('Falha ao carregar sessão.'); }
    }

    document.getElementById('back').onclick = ()=>{ location.href = '/web/login.html'; };
    document.getElementById('close').onclick = async ()=>{
      if (sid){ try{ await fetch(`/api/oauth/google/session/${sid}`, {method:'DELETE'}); }catch(e){} }
      location.href = '/web/login.html';
    };

    document.getElementById('create').onclick = async ()=>{
      elErr.style.display='none'; elOk.style.display='none';
      const u = (username.value||'').trim();
      if (!u || u.includes('@')){ showErr('Informe um Nome de Usuário válido (sem @).'); return; }
      try{
        const r = await fetch(`/api/oauth/google/session/${sid}/finalize`, {
          method:'POST',
          headers:{'Content-Type':'application/json'},
          body: JSON.stringify({ username: u, name: name.value||'', email: email.value||'' })
        });
        const j = await r.json();
        if (!r.ok || !j.ok){ showErr(j.error || 'Falha ao criar conta.'); return; }
        showOk('Conta criada (modo demo). Em breve conectaremos ao banco.');
        setTimeout(()=>{ location.href = '/web/login.html'; }, 1200);
      }catch(e){ showErr('Erro de rede.'); }
    };

    load();
  </script>
</body>
</html>
