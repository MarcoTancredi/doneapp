
<!doctype html>
<html lang="pt-br">
<head>
<meta charset="utf-8">
<title>Perfil — DoneApp</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
 *{box-sizing:border-box}
 body{margin:0;min-height:100vh;display:grid;place-items:center;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
   background:linear-gradient(180deg,#0b1024,#130a1f);color:#e5e7eb}
 .phone{width:min(860px,96vw);padding:22px}
 .card{background:#0b1226;border:1px solid #1f2a44;padding:16px;border-radius:12px;box-shadow:0 0 0 1px #0f1a33}
 .grid{display:grid;grid-template-columns:1fr 1fr;gap:10px}
 .field input{width:100%;padding:12px;border-radius:10px;border:1px solid #334155;background:#0f172a;color:#e5e7eb}
 .row{display:flex;gap:10px;margin-top:12px}
 .row button{padding:10px 12px;border-radius:10px;border:1px solid #334155;background:#0f172a;color:#e5e7eb;cursor:pointer}
 .primary{background:#0ea5e9;color:#001020;border-color:#38bdf8}
 .muted{opacity:.85;font-size:12px}
 .toast{position:fixed;left:50%;transform:translateX(-50%);bottom:18px;background:#111827;border:1px solid #334155;padding:10px 14px;border-radius:10px;opacity:.95}
</style>
</head>
<body>
<div class="phone">
  <div class="card">
    <h2>Meu perfil</h2>
    <div class="grid">
      <div class="field"><label>Nome</label><input id="full_name"></div>
      <div class="field"><label>Empresa</label><input id="company"></div>
      <div class="field"><label>Telefone</label><input id="phone" placeholder="+55 11 9999-9999"></div>
      <div class="field"><label>E-mail</label><input id="email" readonly></div>
      <div class="field"><label>Usuário</label><input id="username" readonly></div>
    </div>
    <div class="muted" style="margin-top:8px">Para SSO, senha é opcional.</div>
    <div class="grid" style="margin-top:8px">
      <div class="field"><label>Nova senha</label><input id="pwd1" type="password"></div>
      <div class="field"><label>Confirmar</label><input id="pwd2" type="password"></div>
    </div>
    <div class="row">
      <button id="back">Voltar</button>
      <button class="primary" id="save">Salvar</button>
    </div>
    <div class="muted" id="msg" style="margin-top:8px">—</div>
  </div>
</div>
<script>
const API_ORIGIN = (location.hostname.endsWith('planetamicro.com.br') ? 'https://api.planetamicro.com.br' : '');
const g = id=>document.getElementById(id);
function toast(s){ const t=document.createElement('div'); t.className='toast'; t.textContent=s; document.body.appendChild(t); setTimeout(()=>t.remove(),3000); }

(async()=>{
  try{
    const r = await fetch(API_ORIGIN + '/api/me', {credentials:'include'}); 
    if(r.status===401){ location.href='/web/login.html'; return; }
    const me = await r.json();
    g('full_name').value = me.full_name||'';
    g('company').value   = me.company||'';
    g('phone').value     = me.phone||'';
    g('email').value     = me.email||'';
    g('username').value  = me.username||'';
  }catch(e){}
})();
g('back').onclick=()=>history.back();
g('save').onclick=async()=>{
  const body = {
    full_name:g('full_name').value, company:g('company').value, phone:g('phone').value,
    password:(g('pwd1').value && g('pwd1').value===g('pwd2').value)?g('pwd1').value:null
  };
  try{
    const r = await fetch(API_ORIGIN + '/api/profile',{method:'POST',headers:{'Content-Type':'application/json'},credentials:'include',body:JSON.stringify(body)});
    if(!r.ok) throw 0;
    g('msg').textContent = 'Perfil salvo!';
    toast('Perfil salvo!');
  }catch(e){
    g('msg').textContent = 'Perfil: endpoint em desenvolvimento.';
    toast('Perfil: endpoint em desenvolvimento.');
  }
};
</script>
</body>
</html>
