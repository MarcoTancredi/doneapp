
<!doctype html>
<html lang="pt-br">
<head>
<meta charset="utf-8">
<title>Cadastro — DoneApp</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
 *{box-sizing:border-box}
 body{margin:0;min-height:100vh;display:grid;place-items:center;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;background:linear-gradient(180deg,#0b1024,#130a1f);color:#e5e7eb}
 .phone{width:min(520px,94vw);padding:24px}
 .card{background:rgba(11,18,38,.72);backdrop-filter:blur(10px);border:1px solid #1f2a44;border-radius:18px;padding:22px;box-shadow:0 10px 40px rgba(0,0,0,.35)}
 .grid{display:grid;grid-template-columns:1fr 1fr;gap:10px}
 .field{margin:8px 0}
 input{width:100%;padding:12px;border-radius:12px;border:1px solid #334155;background:#0f172a;color:#e5e7eb}
 .row{display:flex;gap:10px;margin-top:12px}
 .btn{padding:12px 14px;border-radius:10px;border:1px solid #334155;background:#0f172a;color:#e5e7eb;cursor:pointer}
 .primary{background:#0ea5e9;color:#001020;border-color:#38bdf8}
 .muted{opacity:.85}
 .toast{position:fixed;left:50%;transform:translateX(-50%);bottom:18px;background:#111827;border:1px solid #334155;padding:10px 14px;border-radius:10px;opacity:.95}
</style>
</head>
<body>
<div class="phone">
  <div class="card">
    <h2>Cadastro</h2>
    <div class="grid">
      <div class="field"><label>Usuário</label><input id="username" placeholder="único, sem @"></div>
      <div class="field"><label>Nome completo</label><input id="full_name"></div>
      <div class="field"><label>Empresa</label><input id="company"></div>
      <div class="field"><label>Telefone</label><input id="phone" placeholder="+55 11 9999-9999"></div>
      <div class="field"><label>E-mail</label><input id="email" type="email"></div>
      <div class="field"><label>Senha (opcional p/ SSO)</label><input id="password" type="password"></div>
    </div>
    <div class="row">
      <button class="btn" id="back">Voltar</button>
      <button class="btn primary" id="create">Criar conta</button>
    </div>
    <div class="muted" id="msg" style="margin-top:8px">—</div>
  </div>
</div>
<script>
const API_ORIGIN = (location.hostname.endsWith('planetamicro.com.br') ? 'https://api.planetamicro.com.br' : '');
const p = new URLSearchParams(location.search);
const sid = p.get('sid')||'';
function toast(s){ const t=document.createElement('div'); t.className='toast'; t.textContent=s; document.body.appendChild(t); setTimeout(()=>t.remove(),3000); }
document.getElementById('back').onclick=()=>location.href='/web/login.html';
document.getElementById('create').onclick=async()=>{
  const body = {
    username:document.getElementById('username').value.trim(),
    full_name:document.getElementById('full_name').value.trim(),
    company:document.getElementById('company').value.trim(),
    phone:document.getElementById('phone').value.trim(),
    email:document.getElementById('email').value.trim(),
    password:document.getElementById('password').value,
    sid: sid || null
  };
  if(!body.username || !body.email){ toast('Usuário e e-mail são obrigatórios.'); return; }
  if(body.username.includes('@')){ toast('Usuário não pode conter @.'); return; }
  try{
    const r = await fetch(API_ORIGIN + '/api/register', {method:'POST',headers:{'Content-Type':'application/json'},credentials:'include',body:JSON.stringify(body)});
    if(!r.ok){ const j=await r.json().catch(()=>({})); toast(j.error||'Falha no cadastro'); return; }
    toast('Cadastro criado!'); 
    setTimeout(()=>location.href='/web/login.html?registered=1',800);
  }catch(e){ toast('Erro de rede no cadastro'); }
};
</script>
</body>
</html>
